<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>おうちレストラン</title>
  <style>
    /* ==============================
       GLOBAL STYLES & THEME SETUP
       ============================== */
    body {
      font-family: 'Press Start 2P', cursive; /* Retro pixel font */
      background: #f5f5f5;
      color: #222;
      margin: 0;
      padding: 20px;
      line-height: 1.5;
      background-image: linear-gradient(#ddd 1px, transparent 1px),
                        linear-gradient(90deg, #ddd 1px, transparent 1px);
      background-size: 20px 20px; /* Pixel grid effect */
    }

    /* Buttons */
    button {
      font-family: inherit;
      padding: 10px;
      border: 3px solid #222;
      background: #fff;
      cursor: pointer;
      box-shadow: 4px 4px #222;
      margin: 4px;
    }
    button:active {
      box-shadow: 2px 2px #222;
      transform: translate(2px,2px);
    }

    /* Panels for each section */
    .panel {
      border: 4px solid #222;
      padding: 10px;
      margin-bottom: 20px;
      background: #fff;
    }

    h1,h2 {
      font-size: 16px;
    }

    /* Menu items container */
    .menu {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .card {
      border: 3px solid #222;
      padding: 8px;
      background: #e0e0e0;
      flex: 1 0 150px;
    }

    /* Individual menu item (clickable) */
    .item {
      display: flex;
      justify-content: space-between;
      margin: 6px 0;
      cursor: pointer;
      border: 2px dashed transparent;
      padding: 2px;
    }
    .item:focus {
      outline: none;
      border-color: #222;
      background: #ff0;
    }
    .badge {
      background: #222;
      color: #fff;
      padding: 2px 4px;
      font-size: 10px;
    }

    /* Cart list */
    .cart-list {
      list-style: none;
      padding: 0;
    }
    .cart-list li {
      margin: 4px 0;
    }

    /* High Contrast Mode */
    .contrast {
      background: #000;
      color: #0f0;
    }
    .contrast button {
      background: #000;
      color: #0f0;
      border-color: #0f0;
      box-shadow: 4px 4px #0f0;
    }
  </style>
</head>
<body>
  <!-- ==============================
       HEADER SECTION
       ============================== -->
  <header class="panel">
    <h1>🍴 おうちレストラン</h1>
    <button id="hcBtn" aria-pressed="false">高コントラスト切替</button>
  </header>

  <!-- ==============================
       MENU SECTION: MAINS
       Each item has data-name and optional data-cat
       ============================== -->
  <section class="panel" aria-labelledby="mainsTitle">
    <h2 id="mainsTitle">🍚 メイン</h2>
    <div class="menu">
      <div class="card" aria-label="メイン1">
        <div class="item" tabindex="0" data-name="冷凍チャーハン" data-cat="main"><span class="label">🍳 冷凍チャーハン</span><span class="badge">＋</span></div>
        <div class="item" tabindex="0" data-name="焼きそば" data-cat="main"><span class="label">🥢 焼きそば</span><span class="badge">＋</span></div>
      </div>
      <div class="card" aria-label="メイン2">
        <div class="item" tabindex="0" data-name="オムライス" data-cat="main"><span class="label">🍳 オムライス</span><span class="badge">＋</span></div>
        <div class="item" tabindex="0" data-name="カレーライス" data-cat="main"><span class="label">🍛 カレーライス</span><span class="badge">＋</span></div>
      </div>
    </div>
  </section>

  <!-- ==============================
       MENU SECTION: SIDES
       These are REQUIRED to place an order.
       data-cat="side" is critical.
       ============================== -->
  <section class="panel" aria-labelledby="sidesTitle">
    <h2 id="sidesTitle">🥗 サイド</h2>
    <div class="menu">
      <div class="card" aria-label="サイド1">
        <div class="item" tabindex="0" data-name="チンゲン菜ガーリック" data-cat="side"><span class="label">🧄 チンゲン菜ガーリック</span><span class="badge">＋</span></div>
        <div class="item" tabindex="0" data-name="茄子の煮浸し" data-cat="side"><span class="label">🍆 茄子の煮浸し</span><span class="badge">＋</span></div>
        <div class="item" tabindex="0" data-name="茄子の味噌汁" data-cat="side"><span class="label">🍲 茄子の味噌汁</span><span class="badge">＋</span></div>
      </div>
      <div class="card" aria-label="サイド2">
        <div class="item" tabindex="0" data-name="プチトマト" data-cat="side"><span class="label">🍅 プチトマト</span><span class="badge">＋</span></div>
        <div class="item" tabindex="0" data-name="アボカドしょう油" data-cat="side"><span class="label">🥑 アボカドしょう油</span><span class="badge">＋</span></div>
      </div>
    </div>
  </section>

  <!-- ==============================
       MENU SECTION: DRINKS
       ============================== -->
  <section class="panel" aria-labelledby="drinksTitle">
    <h2 id="drinksTitle">🥤 ドリンク</h2>
    <div class="menu">
      <div class="card" aria-label="ドリンク">
        <div class="item" tabindex="0" data-name="コーラ" data-cat="drink"><span class="label">🥤 コーラ</span><span class="badge">＋</span></div>
        <div class="item" tabindex="0" data-name="お茶" data-cat="drink"><span class="label">🍵 お茶</span><span class="badge">＋</span></div>
      </div>
    </div>
  </section>

  <!-- ==============================
       CART SECTION
       ============================== -->
  <section class="panel" aria-labelledby="cartTitle">
    <h2 id="cartTitle">🛒 カート</h2>
    <ul id="cart" class="cart-list"></ul>
    <button id="clearBtn">カートを空にする</button>
  </section>

  <!-- ==============================
       ORDER SECTION
       ============================== -->
  <section class="panel" aria-labelledby="orderTitle">
    <h2 id="orderTitle">📦 注文</h2>
    <label for="note">メモ:</label><br>
    <textarea id="note" rows="3" cols="40"></textarea><br>
    <button id="orderBtn">注文する</button>
    <p id="status" role="status"></p>
  </section>

  <!-- ==============================
       ACCESSIBILITY LIVE REGION
       Announces updates to screen readers.
       ============================== -->
  <div id="live" aria-live="polite" style="position:absolute;left:-9999px;"></div>

  <script>
    /* ==============================
       JAVASCRIPT LOGIC
       ============================== */

    // DOM references
    const hcBtn = document.getElementById('hcBtn');
    const cartEl = document.getElementById('cart');
    const clearBtn = document.getElementById('clearBtn');
    const orderBtn = document.getElementById('orderBtn');
    const noteEl = document.getElementById('note');
    const statusEl = document.getElementById('status');
    const live = document.getElementById('live');

    // Data structures
    const order = new Map(); // Keeps track of { name -> quantity }
    const categories = new Map(); // Keeps track of { name -> category }

    const WEBHOOK_URL = "https://script.google.com/macros/s/YOUR-SCRIPT-ID/exec"; // Replace with your webhook

    // ===============
    // THEME TOGGLE
    // ===============
    hcBtn.addEventListener('click', () => {
      const pressed = hcBtn.getAttribute('aria-pressed') === 'true';
      hcBtn.setAttribute('aria-pressed', String(!pressed));
      document.body.classList.toggle('contrast');
    });

    // ===============
    // ADD ITEM HANDLER
    // ===============
    function addItem(name, cat){
      if(cat){ categories.set(name, cat); } // Remember the category for validation
      const q = order.get(name) || 0;
      order.set(name, q + 1);
      render();
      live.textContent = `${name} を追加（合計 ${order.get(name)}）`;
    }

    // Bind all menu items to add on click/keyboard
    document.querySelectorAll('.item').forEach(el => {
      el.addEventListener('click', () => addItem(el.dataset.name, el.dataset.cat));
      el.addEventListener('keydown', (e) => {
        if(e.key === 'Enter' || e.key === ' '){
          e.preventDefault();
          addItem(el.dataset.name, el.dataset.cat);
        }
      });
    });

    // ===============
    // RENDER CART
    // ===============
    function render(){
      cartEl.innerHTML = '';
      order.forEach((qty,name) => {
        const li = document.createElement('li');
        li.textContent = `${name} x ${qty} `;

        // Add (+) button
        const plus = document.createElement('button');
        plus.textContent = '+';
        plus.addEventListener('click', ()=>{ addItem(name, categories.get(name)); });

        // Add (-) button
        const minus = document.createElement('button');
        minus.textContent = '-';
        minus.addEventListener('click', ()=>{
          const q = order.get(name);
          if(q>1){ order.set(name,q-1);} else { order.delete(name);} 
          render();
        });

        li.appendChild(plus);
        li.appendChild(minus);
        cartEl.appendChild(li);
      });
    }

    // Clear cart
    clearBtn.addEventListener('click', ()=>{ order.clear(); render(); });

    // ===============
    // SUBMIT ORDER
    // ===============
    orderBtn.addEventListener('click', async () => {
      if(order.size === 0){
        statusEl.textContent = 'カートが空です。';
        return;
      }

      // Ensure at least one side item
      const hasSide = Array.from(order.keys()).some(name => categories.get(name) === "side");
      if(!hasSide){
        statusEl.textContent = '⚠️ サイドメニューを少なくとも1つ選んでください。';
        return;
      }

      // Prepare payload
      const items = Array.from(order, ([name, qty]) => ({ name, qty }));
      const note = noteEl.value.trim();

      statusEl.textContent = '送信中…';
      try{
        await fetch(WEBHOOK_URL, {
          method: 'POST',
          mode: 'no-cors', // For Google Apps Script; otherwise you can remove
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ items, note })
        });
        statusEl.textContent = '✅ 注文を送信しました。ありがとうございます！';
        order.clear(); render(); noteEl.value = '';
      }catch(err){
        statusEl.textContent = '❌ 送信に失敗しました。ネットワークを確認してください。';
      }
    });
  </script>
</body>
</html>
